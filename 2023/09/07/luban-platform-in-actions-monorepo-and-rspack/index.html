<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Rspress v1.15.0"><title data-rh="true">鲁班平台Monorepo+rspack构建优化实践 - SumyBlog</title><meta data-rh="true" name="description" content="SumyGG&#x27;s Blog"/><meta data-rh="true" name="referrer" content="no-referrer-when-downgrade"/><link data-rh="true" rel="alternate" type="application/rss+xml" href="https://sumygg.com/rss/feed.rss"/>
<script id="check-dark-light">
;(() => {
  const saved = localStorage.getItem('rspress-theme-appearance')
  const prefereDark = window.matchMedia('(prefers-color-scheme: dark)').matches
  if (!saved || saved === 'auto' ? prefereDark : saved === 'dark') {
    document.documentElement.classList.add('dark')
  }
})()
</script>
<title>SumyBlog</title><link rel="icon" href="/favicon.ico"><script defer="defer" src="/static/js/styles.df47b71a.js"></script><script defer="defer" src="/static/js/lib-lodash.b329996d.js"></script><script defer="defer" src="/static/js/lib-polyfill.6c0e3b15.js"></script><script defer="defer" src="/static/js/lib-react.1a4d633b.js"></script><script defer="defer" src="/static/js/lib-router.345150bc.js"></script><script defer="defer" src="/static/js/4051.e82f0025.js"></script><script defer="defer" src="/static/js/index.e31e71f4.js"></script><link href="/static/css/styles.fb4df59b.css" rel="stylesheet"><script async src="https://www.googletagmanager.com/gtag/js?id=G-2NDCXW15G4"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2NDCXW15G4")</script><link href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" rel="stylesheet" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" crossorigin="anonymous"></script></head><body ><div id="root"><div><div><div class="navContainer_f6cde sticky rspress-nav px-6 "><div class="container_f6cde flex justify-between items-center h-full"><div class="navBarTitle_f6cde"><a href="/" class="flex items-center w-full h-full text-base font-semibold transition-opacity duration-300 hover:opacity-60"><span>SumyBlog</span></a></div><div class="undefined flex flex-1 justify-end items-center"><div class="rightNav_f6cde"><div class="flex sm:flex-1 items-center sm:pl-4 sm:pr-2"><div class="rspress-nav-search-button navSearchButton_6e282"><button><svg width="18" height="18" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9Z"></path></svg><p class="searchWord_6e282">搜索...</p><div style="opacity:0"><span></span><span>K</span></div></button></div><div class="mobileNavSearchButton_6e282"><svg width="24" height="24" viewBox="0 0 32 32"><path fill="var(--rp-c-gray)" d="m29 27.586-7.552-7.552a11.018 11.018 0 1 0-1.414 1.414L27.586 29ZM4 13a9 9 0 1 1 9 9 9.01 9.01 0 0 1-9-9Z"></path></svg></div></div><div class="rspress-nav-menu menu h-14"><a class="link_03735  cursor-pointer" target="" href="/blog/flinks/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">友情链接</div></a><a class="link_03735  cursor-pointer" target="" href="/blog/archives/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">归档</div></a><a class="link_03735  cursor-pointer" target="" href="/blog/categories/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">分类</div></a><a class="link_03735  cursor-pointer" target="" href="/blog/tags/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">标签</div></a><a class="link_03735  cursor-pointer" target="" href="/about/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">关于我</div></a></div><div class="flex-center flex-row"><div class="mx-2"><div class="md:mr-2 rspress-nav-appearance"><div class="p-1 border border-solid border-gray-300 text-gray-400  cursor-pointer rounded-md hover:border-gray-600 hover:text-gray-600 dark:hover:border-gray-200 dark:hover:text-gray-200 transition-all duration-300"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zm0-10c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zM12 4c-.6 0-1-.4-1-1V1c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1zM12 24c-.6 0-1-.4-1-1v-2c0-.6.4-1 1-1s1 .4 1 1v2c0 .6-.4 1-1 1zM5.6 6.6c-.3 0-.5-.1-.7-.3L3.5 4.9c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.1.2-.4.3-.7.3zM19.8 20.8c-.3 0-.5-.1-.7-.3l-1.4-1.4c-.4-.4-.4-1 0-1.4s1-.4 1.4 0l1.4 1.4c.4.4.4 1 0 1.4-.2.2-.5.3-.7.3zM3 13H1c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1zM23 13h-2c-.6 0-1-.4-1-1s.4-1 1-1h2c.6 0 1 .4 1 1s-.4 1-1 1zM4.2 20.8c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.4.3-.7.3zM18.4 6.6c-.3 0-.5-.1-.7-.3-.4-.4-.4-1 0-1.4l1.4-1.4c.4-.4 1-.4 1.4 0s.4 1 0 1.4l-1.4 1.4c-.2.2-.5.3-.7.3z"></path></svg></div></div></div><div class="social-links menu-item_93d67 flex-center relative"><div class="flex-center h-full gap-x-4 transition-colors duration-300 md:mr-2"><a href="https://github.com/sumy7/" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_93d67"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></div></a><a href="https://weibo.com/sumy7" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_93d67"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="iconify iconify--ri" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path fill="currentColor" d="M17.525 11.378c1.263.392 2.669 1.336 2.669 3.004c0 2.763-3.98 6.239-9.964 6.239c-4.565 0-9.23-2.213-9.23-5.852c0-1.902 1.204-4.102 3.277-6.177c2.773-2.77 6.004-4.033 7.219-2.816c.537.537.588 1.464.244 2.572c-.178.557.525.25.525.25c2.24-.938 4.196-.994 4.909.027c.38.543.343 1.306-.008 2.19c-.163.407.048.471.36.563zm-7.282 7.939c3.641-.362 6.401-2.592 6.167-4.983c-.237-2.391-3.382-4.038-7.023-3.677c-3.64.36-6.403 2.59-6.167 4.98c.237 2.394 3.382 4.039 7.023 3.68zM6.16 14.438c.754-1.527 2.712-2.39 4.446-1.94c1.793.463 2.707 2.154 1.976 3.8c-.744 1.682-2.882 2.578-4.695 1.993c-1.752-.566-2.493-2.294-1.727-3.853zm1.446 2.587c.568.257 1.325.013 1.676-.55c.346-.568.163-1.217-.407-1.459c-.563-.237-1.291.008-1.64.553c-.354.547-.189 1.202.371 1.456zm2.206-1.808c.219.092.501-.012.628-.231c.123-.22.044-.466-.178-.548c-.216-.084-.486.018-.613.232c-.123.214-.054.458.163.547zM19.873 9.5a.725.725 0 1 1-1.378-.451a1.38 1.38 0 0 0-.288-1.357a1.395 1.395 0 0 0-1.321-.425a.723.723 0 1 1-.303-1.416a2.836 2.836 0 0 1 3.29 3.649zm-3.916-6.575A5.831 5.831 0 0 1 21.5 4.72a5.836 5.836 0 0 1 1.22 5.704a.838.838 0 0 1-1.06.54a.844.844 0 0 1-.542-1.062a4.143 4.143 0 0 0-4.807-5.327a.845.845 0 0 1-.354-1.65z"></path></svg></div></a><a href="https://twitter.com/sumygg" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_93d67"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>X</title><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"></path></svg></div></a></div><div class="md:ml-1 p-2"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></div></div></div></div><div class="mobileNavMenu_f6cde"><div class="navScreen_457e8 " id="navScreen"><div class="container_457e8"><div class="navMenu_457e8"><div class="navMenuItem_457e8 w-full"><a class="link_03735  cursor-pointer" target="" href="/blog/flinks/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">友情链接</div></a></div><div class="navMenuItem_457e8 w-full"><a class="link_03735  cursor-pointer" target="" href="/blog/archives/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">归档</div></a></div><div class="navMenuItem_457e8 w-full"><a class="link_03735  cursor-pointer" target="" href="/blog/categories/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">分类</div></a></div><div class="navMenuItem_457e8 w-full"><a class="link_03735  cursor-pointer" target="" href="/blog/tags/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">标签</div></a></div><div class="navMenuItem_457e8 w-full"><a class="link_03735  cursor-pointer" target="" href="/about/index.html"><div class="rspress-nav-menu-item singleItem_f6cde  text-sm font-medium mx-1.5 px-3 py-2 flex items-center">关于我</div></a></div></div><div class="flex-center flex-col gap-2"><div class="mt-2 navAppearance_457e8 flex justify-center"></div><div class="social-links menu-item_93d67 flex-center relative"><div class="flex-center h-full gap-x-4 transition-colors duration-300 md:mr-2"><a href="https://github.com/sumy7/" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_93d67"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></div></a><a href="https://weibo.com/sumy7" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_93d67"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="iconify iconify--ri" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path fill="currentColor" d="M17.525 11.378c1.263.392 2.669 1.336 2.669 3.004c0 2.763-3.98 6.239-9.964 6.239c-4.565 0-9.23-2.213-9.23-5.852c0-1.902 1.204-4.102 3.277-6.177c2.773-2.77 6.004-4.033 7.219-2.816c.537.537.588 1.464.244 2.572c-.178.557.525.25.525.25c2.24-.938 4.196-.994 4.909.027c.38.543.343 1.306-.008 2.19c-.163.407.048.471.36.563zm-7.282 7.939c3.641-.362 6.401-2.592 6.167-4.983c-.237-2.391-3.382-4.038-7.023-3.677c-3.64.36-6.403 2.59-6.167 4.98c.237 2.394 3.382 4.039 7.023 3.68zM6.16 14.438c.754-1.527 2.712-2.39 4.446-1.94c1.793.463 2.707 2.154 1.976 3.8c-.744 1.682-2.882 2.578-4.695 1.993c-1.752-.566-2.493-2.294-1.727-3.853zm1.446 2.587c.568.257 1.325.013 1.676-.55c.346-.568.163-1.217-.407-1.459c-.563-.237-1.291.008-1.64.553c-.354.547-.189 1.202.371 1.456zm2.206-1.808c.219.092.501-.012.628-.231c.123-.22.044-.466-.178-.548c-.216-.084-.486.018-.613.232c-.123.214-.054.458.163.547zM19.873 9.5a.725.725 0 1 1-1.378-.451a1.38 1.38 0 0 0-.288-1.357a1.395 1.395 0 0 0-1.321-.425a.723.723 0 1 1-.303-1.416a2.836 2.836 0 0 1 3.29 3.649zm-3.916-6.575A5.831 5.831 0 0 1 21.5 4.72a5.836 5.836 0 0 1 1.22 5.704a.838.838 0 0 1-1.06.54a.844.844 0 0 1-.542-1.062a4.143 4.143 0 0 0-4.807-5.327a.845.845 0 0 1-.354-1.65z"></path></svg></div></a><a href="https://twitter.com/sumygg" target="_blank" rel="noopener noreferrer" class="social-links"><div class="social-links-icon_93d67"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>X</title><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"></path></svg></div></a></div><div class="md:ml-1 p-2"><svg width="1em" height="1em" viewBox="0 0 32 32"><path fill="currentColor" d="M16 22 6 12l1.4-1.4 8.6 8.6 8.6-8.6L26 12z"></path></svg></div></div></div></div></div><button aria-label="mobile hamburger" class=" navHamburger_e7b06 text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" fill="currentColor"><circle cx="8" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="24" cy="16" r="2" fill="currentColor"></circle></svg></button></div></div></div></div><section><div class="docLayout_edeb4 pt-0"><div class="content_edeb4 rspress-doc-container flex flex-shrink-0 mx-auto"><div class="w-full flex-1"><div><div class="rspress-doc"><!--$--><h1 id="鲁班平台monoreporspack构建优化实践" class="text-3xl mb-10 leading-10 tracking-tight title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#鲁班平台monoreporspack构建优化实践">#</a>鲁班平台Monorepo+rspack构建优化实践</h1><div class="postInfoContainer_07bfd -mt-5 mb-8"><span class="postInfoMetaItem_07bfd"><iconify-icon icon="{&quot;body&quot;:&quot;&lt;path fill=\&quot;currentColor\&quot; d=\&quot;M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V5h16V4H0V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5z\&quot;/&gt;&quot;}" inline="true"></iconify-icon> <!-- -->2023-09-07</span><span class="postInfoMetaItem_07bfd"><iconify-icon icon="{&quot;body&quot;:&quot;&lt;path fill=\&quot;currentColor\&quot; d=\&quot;M9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.825a2 2 0 0 1-1.991-1.819l-.637-7a1.99 1.99 0 0 1 .342-1.31L.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3zm-8.322.12C1.72 3.042 1.95 3 2.19 3h5.396l-.707-.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981l.006.139z\&quot;/&gt;&quot;}" inline="true"></iconify-icon> <a class="link_03735  cursor-pointer" target="" href="/blog/categories/index.html?category=果然还是前端">果然还是前端</a></span><span class="postInfoMetaItem_07bfd"><iconify-icon icon="{&quot;body&quot;:&quot;&lt;path fill=\&quot;currentColor\&quot; d=\&quot;M2 1a1 1 0 0 0-1 1v4.586a1 1 0 0 0 .293.707l7 7a1 1 0 0 0 1.414 0l4.586-4.586a1 1 0 0 0 0-1.414l-7-7A1 1 0 0 0 6.586 1H2zm4 3.5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0z\&quot;/&gt;&quot;}" inline="true"></iconify-icon> <a class="link_03735  cursor-pointer" target="" href="/blog/tags/index.html?tag=前端">前端</a></span><span class="postInfoMetaItem_07bfd"><iconify-icon icon="{&quot;body&quot;:&quot;&lt;path fill=\&quot;currentColor\&quot; d=\&quot;M2 1a1 1 0 0 0-1 1v4.586a1 1 0 0 0 .293.707l7 7a1 1 0 0 0 1.414 0l4.586-4.586a1 1 0 0 0 0-1.414l-7-7A1 1 0 0 0 6.586 1H2zm4 3.5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0z\&quot;/&gt;&quot;}" inline="true"></iconify-icon> <a class="link_03735  cursor-pointer" target="" href="/blog/tags/index.html?tag=构建">构建</a></span><span class="postInfoMetaItem_07bfd"><iconify-icon icon="{&quot;body&quot;:&quot;&lt;path fill=\&quot;currentColor\&quot; d=\&quot;M2 1a1 1 0 0 0-1 1v4.586a1 1 0 0 0 .293.707l7 7a1 1 0 0 0 1.414 0l4.586-4.586a1 1 0 0 0 0-1.414l-7-7A1 1 0 0 0 6.586 1H2zm4 3.5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0z\&quot;/&gt;&quot;}" inline="true"></iconify-icon> <a class="link_03735  cursor-pointer" target="" href="/blog/tags/index.html?tag=Monorepo">Monorepo</a></span><span class="postInfoMetaItem_07bfd"><iconify-icon icon="{&quot;body&quot;:&quot;&lt;path fill=\&quot;currentColor\&quot; d=\&quot;M2 1a1 1 0 0 0-1 1v4.586a1 1 0 0 0 .293.707l7 7a1 1 0 0 0 1.414 0l4.586-4.586a1 1 0 0 0 0-1.414l-7-7A1 1 0 0 0 6.586 1H2zm4 3.5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0z\&quot;/&gt;&quot;}" inline="true"></iconify-icon> <a class="link_03735  cursor-pointer" target="" href="/blog/tags/index.html?tag=rspack">rspack</a></span><span class="postInfoMetaItem_07bfd"><iconify-icon icon="{&quot;body&quot;:&quot;&lt;path fill=\&quot;currentColor\&quot; d=\&quot;M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0zM9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1zM5.485 6.879l1.036 4.144l.997-3.655a.5.5 0 0 1 .964 0l.997 3.655l1.036-4.144a.5.5 0 0 1 .97.242l-1.5 6a.5.5 0 0 1-.967.01L8 9.402l-1.018 3.73a.5.5 0 0 1-.967-.01l-1.5-6a.5.5 0 1 1 .97-.242z\&quot;/&gt;&quot;}" inline="true"></iconify-icon> <!-- -->2.6k<!-- --> 字</span><span class="postInfoMetaItem_07bfd"><iconify-icon icon="{&quot;body&quot;:&quot;&lt;path fill=\&quot;currentColor\&quot; d=\&quot;M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z\&quot;/&gt;&quot;}" inline="true"></iconify-icon> <!-- -->8<!-- --> 分钟</span><span class="postInfoMetaItem_07bfd"><iconify-icon icon="{&quot;body&quot;:&quot;&lt;g fill=\&quot;currentColor\&quot;&gt;&lt;path d=\&quot;M10.5 8a2.5 2.5 0 1 1-5 0a2.5 2.5 0 0 1 5 0z\&quot;/&gt;&lt;path d=\&quot;M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7a3.5 3.5 0 0 0 0 7z\&quot;/&gt;&lt;/g&gt;&quot;}" inline="true"></iconify-icon> </span></div>
<p class="my-4 leading-7">鲁班平台是我们内部的一个低代码搭建平台，承载着移动端、大屏端和RN的活动搭建。</p>
<p class="my-4 leading-7">鲁班平台采用了一个仓库管理代码，整个代码仓库结构如下：</p>
<p class="my-4 leading-7"><img alt="鲁班旧版架构" src="data:image/png;base64,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"/></p>
<p class="my-4 leading-7">随着业务发展，一些问题也随之显现出来：</p>
<ol class="list-decimal pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">目录结构混乱，模块之间相互引用</li>
<li class="[&amp;:not(:first-child)]:mt-2">整个client由同一个 package.json 管理，依赖冗余</li>
<li class="[&amp;:not(:first-child)]:mt-2">构建时间长，在流水线上平均一次需要 8 min</li>
</ol>
<p class="my-4 leading-7">项目基于 webpack4 进行构建，之前我们一直在寻找好的解决方案。首先 Monorepo 已经是一个成熟的理念，
也曾尝试迁移到 Monorepo。但是从最终收益来看只是改变了项目结构，构建成本未发生实质的变化。
而 Rspack 的出现，才使得这个方案变得更有价值。</p>
<h2 id="什么是monorepo" class="mt-14 mb-6 text-2xl tracking-tight title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#什么是monorepo">#</a>什么是Monorepo？</h2>
<p class="my-4 leading-7">一个产品会有多个项目，每个项目之间会存在版本同步的问题，如何在其中一个项目发布上线后，保证每个项目版本升级后的版本同步问题，
提出的解决方案就是 monorepo 策略。</p>
<p class="my-4 leading-7">monorepo 是一种将多个项目代码存储在一个仓库里的软件开发策略（mono 意为单一，repo 意为 仓库）。
与之相对的是另一种流行的代码管理方式 MultiRepo，即每个项目对应一个单独的仓库来分散管理。</p>
<p class="my-4 leading-7"><img alt="Monorepo" src="/static/image/monorepo.77c4b6ab.png"/></p>
<h2 id="rspack" class="mt-14 mb-6 text-2xl tracking-tight title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#rspack">#</a>Rspack</h2>
<p class="my-4 leading-7"><a target="_blank" rel="noopener noreferrer" href="https://www.rspack.dev/" class="link-_707cf  link_3b154 inline-link_3b154">Rspack</a> 是一个基于 Rust 的高性能 Web 构建工具，具备与 webpack 生态系统的互操作性，
可以被 webpack 项目低成本集成，并提供更好的构建性能。</p>
<p class="my-4 leading-7">相较于 webpack，Rspack 的构建性能有明显提升，除了 Rust 带来的语言优势，这也来自于它的并行架构和增量编译等特性。
经过 benchmark 验证，Rspack 可以带来 5 ～ 10 倍编译性能的提升。</p>
<p class="my-4 leading-7"><img alt="Rspack" src="/static/image/rspack.d96d2758.png"/></p>
<h2 id="项目结构优化" class="mt-14 mb-6 text-2xl tracking-tight title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#项目结构优化">#</a>项目结构优化</h2>
<p class="my-4 leading-7">之前的代码采用目录的方式进行隔离存放——client 和 server，而 client 的 src 又存放了三个关键模块——cms、activity 和 tvActivity。
于是整个项目结构拆分的方向就确定了。</p>
<p class="my-4 leading-7"><img alt="鲁班优化后架构" src="/static/image/luban-new-architecture.7d620a42.png"/></p>
<p class="my-4 leading-7">整体看来整理前后的目录结构是一一对应的，apps 作为入口，packages 作为项目内部依赖。</p>
<p class="my-4 leading-7">当然这个目录也不是一开始就是确定这样拆分的，apps 的入口确定好了之后，packages 根据后面 rspack 的迁移不断的补充和完成形成的。</p>
<h3 id="创建-monorepo-工程" class="mt-10 mb-2 leading-7 text-xl title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#创建-monorepo-工程">#</a>创建 Monorepo 工程</h3>
<p class="my-4 leading-7">monorepo 有多种驱动方式，一般需要包管理工具的 workspace 功能的支持。这里采用 turborepo + yarn workspace 的模式。</p>
<p class="my-4 leading-7">自己写配置还是比较麻烦的，参考一个现有的使用 <a target="_blank" rel="noopener noreferrer" href="https://turbo.build/repo/docs/getting-started/from-example" class="link-_707cf  link_3b154 inline-link_3b154">https://turbo.build/repo/docs/getting-started/from-example</a> 创建一个示例的 Monorepo 工程</p>
<div class="language-bash"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-bash" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>npx create-turbo -e with-docker</span></span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">根据之前拆分的目录结构，创建对应的目录，并删除实例代码。</p>
<h3 id="项目内的模块依赖" class="mt-10 mb-2 leading-7 text-xl title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#项目内的模块依赖">#</a>项目内的模块依赖</h3>
<p class="my-4 leading-7">要在一个模块引入其它模块，不需要将包 push 到 artifactory 上，而是在对应模块的 package.json 引入。</p>
<div class="language-json"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-json" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-parameter)">&quot;dependencies&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-parameter)">&quot;luban-components&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;*&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">}</span></span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">后续在代码中，使用 <code>luban-components/xxx/xxx</code> 就能引用模块下的文件了。</p>
<h3 id="postcssconfigjs" class="mt-10 mb-2 leading-7 text-xl title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#postcssconfigjs">#</a>postcss.config.js</h3>
<p class="my-4 leading-7">postcss 的配置无它，这里简单提一下。需要在所有需要处理的 css 文件的模块的根目录放置一个 postcss.config.js 文件，
否则 postcss 不会处理这个目录下的文件。</p>
<p class="my-4 leading-7">除了配置文件放置的位置之外，还需要注意版本升级后的新语法，除法需要加括号才会在预处理阶段进行计算。</p>
<h3 id="构建-docker-镜像" class="mt-10 mb-2 leading-7 text-xl title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#构建-docker-镜像">#</a>构建 docker 镜像</h3>
<p class="my-4 leading-7">之前 docker 镜像里会同时存在 nginx 服务和 node 服务。本次迁移也是采用这种模式。</p>
<p class="my-4 leading-7">前端页面只需要将 dist 目录下的成品转移到 nginx 服务目录下。而 node 服务就需要在容器里安装依赖并进行构建。
因此 dockerfile 编写也需要分成两部分进行。</p>
<h4 id="构建前端页面" class="mt-8 leading-6 text-base title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#构建前端页面">#</a>构建前端页面</h4>
<p class="my-4 leading-7">在 package.json 中添加一条命令，<code>--filter</code> 表示只处理对应模块。</p>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>turbo run build --filter</span><span class="token operator">=</span><span>luban-activity --filter</span><span class="token operator">=</span><span>luban-tv-activity --filter</span><span class="token operator">=</span><span>luban-cms</span></span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">构建的时候执行该命令，通过 COPY 执行将 dist 目录下的成品复制到对应目录下</p>
<div class="language-dockerfile"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-dockerfile" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>COPY ./apps/luban-activity/dist /home/work/apps/luban-activity/dist
</span></span><span style="display:block;padding:0 1.25rem">COPY ./apps/luban-tv-activity/dist /home/work/apps/luban-tv-activity/dist
</span><span style="display:block;padding:0 1.25rem">COPY ./apps/luban-cms/dist /home/work/apps/luban-cms/dist
</span><span style="display:block;padding:0 1.25rem">COPY ./nginx/$CI_COMMIT_BRANCH/default.conf /etc/nginx/http.d/</span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<h4 id="构建-node-服务" class="mt-8 leading-6 text-base title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#构建-node-服务">#</a>构建 node 服务</h4>
<p class="my-4 leading-7">在 monorepo 模式下，所有依赖都会被提取到根目录的 node_modules。而 node 执行需要依赖其中的某些包。直接拷贝 node 服务会缺少依赖，
而全部拷贝（包含外部的 node_modules）又会引入前端的一些依赖。</p>
<p class="my-4 leading-7">这个时候就需要使用 turbo 提供的一条指令了 <a target="_blank" rel="noopener noreferrer" href="https://turbo.build/repo/docs/reference/command-line-reference/prune" class="link-_707cf  link_3b154 inline-link_3b154">https://turbo.build/repo/docs/reference/command-line-reference/prune</a></p>
<div class="language-shell"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-shell" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>turbo prune --scope</span><span class="token operator">=</span><span>luban-server --docker</span></span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">这条指令会将 luban-server 模块下依赖的全部文件生成到 out 目录下，我们将 out 目录拷贝到 docker 中，然后执行安装命令。</p>
<div class="language-dockerfile"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-dockerfile" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>COPY ./out/full /home/work/
</span></span><span style="display:block;padding:0 1.25rem">RUN cd /home/work/ &amp;&amp;  \
</span><span style="display:block;padding:0 1.25rem">yarn install --registry=https://pkgs.d.xiaomi.net/artifactory/api/npm/mi-npm/ &amp;&amp;  \
</span><span style="display:block;padding:0 1.25rem">yarn run build
</span><span style="display:block;padding:0 1.25rem">RUN npm install pm2 -g --registry=https://pkgs.d.xiaomi.net/artifactory/api/npm/mi-npm/</span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<h2 id="迁移rspack" class="mt-14 mb-6 text-2xl tracking-tight title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#迁移rspack">#</a>迁移rspack</h2>
<p class="my-4 leading-7">将项目目录进行分模块拆分之后，接下来将 webpack4 的配置迁移到 rspack。这里采用的是先创建一个vue2 的 rspack 空白项目，
然后将模块代码拷入，补充缺少的依赖和配置的方式进行。下面记录一下关键步骤、遇到的问题和解决方案。</p>
<h3 id="迁移配置文件" class="mt-10 mb-2 leading-7 text-xl title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#迁移配置文件">#</a>迁移配置文件</h3>
<p class="my-4 leading-7">根据报错信息，需要补充的配置内容有：</p>
<ol class="list-decimal pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2">devServer.proxy 的本地预览服务器转发配置</li>
<li class="[&amp;:not(:first-child)]:mt-2">builtins.define 中的变量替换</li>
<li class="[&amp;:not(:first-child)]:mt-2">resolve.alias 的路径别名替换</li>
</ol>
<p class="my-4 leading-7">这里直接展示完成后的 rspack.config.js</p>
<div class="language-javascript"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-javascript" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">const</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span> VueLoaderPlugin </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span> </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-function)">require</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;vue-loader&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">const</span><span> path </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-function)">require</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;path&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">const</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span> proxy </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span> </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-function)">require</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&#x27;luban-ci/devServer&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">const</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span> loadEnv </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span> </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-function)">require</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;luban-ci/load-dotenv&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>process</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>env</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-constant)">PROJECT_NAME</span><span> </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;cms&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">const</span><span> buildMode </span><span class="token operator">=</span><span> process</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>env</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-constant)">LUBAN_BUILD_MODE</span><span> </span><span class="token operator">||</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;development&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">const</span><span> env </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-function)">loadEnv</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>buildMode</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;.&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)">/** @type {import(&#x27;@rspack/cli&#x27;).Configuration} */</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">const</span><span> config </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token literal-property" style="color:var(--code-token-parameter)">context</span><span class="token operator">:</span><span> __dirname</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token literal-property" style="color:var(--code-token-parameter)">entry</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>       </span><span class="token literal-property" style="color:var(--code-token-parameter)">main</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;./src/main.js&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token literal-property" style="color:var(--code-token-parameter)">output</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>       </span><span class="token literal-property" style="color:var(--code-token-parameter)">publicPath</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;/&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token literal-property" style="color:var(--code-token-parameter)">devServer</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>       </span><span class="token literal-property" style="color:var(--code-token-parameter)">historyApiFallback</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token literal-property" style="color:var(--code-token-parameter)">index</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;/index.html&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>       </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>       </span><span class="token literal-property" style="color:var(--code-token-parameter)">proxy</span><span class="token operator">:</span><span> proxy
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token literal-property" style="color:var(--code-token-parameter)">devtool</span><span class="token operator">:</span><span> </span><span class="token boolean">false</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token literal-property" style="color:var(--code-token-parameter)">builtins</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>       </span><span class="token literal-property" style="color:var(--code-token-parameter)">html</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>             </span><span class="token literal-property" style="color:var(--code-token-parameter)">template</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;./index.html&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>             </span><span class="token literal-property" style="color:var(--code-token-parameter)">favicon</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;favicon.ico&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>       </span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>       </span><span class="token literal-property" style="color:var(--code-token-parameter)">define</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token string-property" style="color:var(--code-token-parameter)">&quot;process.env&quot;</span><span class="token operator">:</span><span> env </span><span class="token operator">||</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>       </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token literal-property" style="color:var(--code-token-parameter)">resolve</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>       </span><span class="token literal-property" style="color:var(--code-token-parameter)">extensions</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token" style="color:var(--code-token-string)">&quot;.vue&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;.json&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;.js&quot;</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>       </span><span class="token literal-property" style="color:var(--code-token-parameter)">alias</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token string-property" style="color:var(--code-token-parameter)">&quot;@&quot;</span><span class="token operator">:</span><span> path</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">resolve</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>__dirname</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;./src&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-comment)">// 解决el-table在vue高版本渲染空白</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token literal-property" style="color:var(--code-token-parameter)">vue$</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;vue/dist/vue.esm.js&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token literal-property" style="color:var(--code-token-parameter)">api</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;luban-common/lib/js/utils/request/api.js&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token string-property" style="color:var(--code-token-parameter)">&quot;~&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;luban-components&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token string-property" style="color:var(--code-token-parameter)">&quot;js-lib&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;luban-common/lib/js&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token string-property" style="color:var(--code-token-parameter)">&quot;css-lib&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;luban-common/lib/css&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token string-property" style="color:var(--code-token-parameter)">&quot;project-conf&quot;</span><span class="token operator">:</span><span> path</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">resolve</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>__dirname</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;./src/project-conf&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>       </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token literal-property" style="color:var(--code-token-parameter)">plugins</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token" style="color:var(--code-token-keyword)">new</span><span> </span><span class="token class-name">VueLoaderPlugin</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token literal-property" style="color:var(--code-token-parameter)">module</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>       </span><span class="token literal-property" style="color:var(--code-token-parameter)">rules</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>             </span><span class="token literal-property" style="color:var(--code-token-parameter)">test</span><span class="token operator">:</span><span> </span><span class="token regex-delimiter" style="color:var(--code-token-keyword)">/</span><span class="token regex-source language-regex" style="color:var(--code-token-keyword)">\.vue$</span><span class="token regex-delimiter" style="color:var(--code-token-keyword)">/</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>             </span><span class="token literal-property" style="color:var(--code-token-parameter)">use</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token" style="color:var(--code-token-string)">&quot;vue-loader&quot;</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>             </span><span class="token literal-property" style="color:var(--code-token-parameter)">resourceQuery</span><span class="token operator">:</span><span> </span><span class="token regex-delimiter" style="color:var(--code-token-keyword)">/</span><span class="token regex-source language-regex" style="color:var(--code-token-keyword)">lang=ts</span><span class="token regex-delimiter" style="color:var(--code-token-keyword)">/</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>             </span><span class="token literal-property" style="color:var(--code-token-parameter)">type</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;ts&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>             </span><span class="token literal-property" style="color:var(--code-token-parameter)">test</span><span class="token operator">:</span><span> </span><span class="token regex-delimiter" style="color:var(--code-token-keyword)">/</span><span class="token regex-source language-regex" style="color:var(--code-token-keyword)">\.less$</span><span class="token regex-delimiter" style="color:var(--code-token-keyword)">/</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>             </span><span class="token literal-property" style="color:var(--code-token-parameter)">use</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token" style="color:var(--code-token-string)">&quot;vue-style-loader&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;css-loader&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;postcss-loader&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;less-loader&quot;</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>             </span><span class="token literal-property" style="color:var(--code-token-parameter)">type</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;javascript/auto&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>             </span><span class="token literal-property" style="color:var(--code-token-parameter)">test</span><span class="token operator">:</span><span> </span><span class="token regex-delimiter" style="color:var(--code-token-keyword)">/</span><span class="token regex-source language-regex" style="color:var(--code-token-keyword)">\.css$</span><span class="token regex-delimiter" style="color:var(--code-token-keyword)">/</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>             </span><span class="token literal-property" style="color:var(--code-token-parameter)">use</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token" style="color:var(--code-token-string)">&quot;vue-style-loader&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;css-loader&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;postcss-loader&quot;</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>             </span><span class="token literal-property" style="color:var(--code-token-parameter)">type</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;javascript/auto&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>             </span><span class="token literal-property" style="color:var(--code-token-parameter)">test</span><span class="token operator">:</span><span> </span><span class="token regex-delimiter" style="color:var(--code-token-keyword)">/</span><span class="token regex-source language-regex" style="color:var(--code-token-keyword)">\.(png|jpe?g|gif|svg)(\?.*)?$</span><span class="token regex-delimiter" style="color:var(--code-token-keyword)">/</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>             </span><span class="token literal-property" style="color:var(--code-token-parameter)">type</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;asset&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>          </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>       </span><span class="token" style="color:var(--code-token-punctuation)">]</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>module</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>exports </span><span class="token operator">=</span><span> config</span><span class="token" style="color:var(--code-token-punctuation)">;</span></span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<h3 id="多环境配置文件" class="mt-10 mb-2 leading-7 text-xl title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#多环境配置文件">#</a>多环境配置文件</h3>
<p class="my-4 leading-7">目前很流行一套代码多环境部署，但是 webpack 和 rspack 都没有支持。</p>
<blockquote class="border-l-2 border-solid border-divider pl-4 my-6 transition-colors duration-500 blockquote_3b154">
<p class="my-4 leading-7">不过 webpack 已经计划支持了 <a target="_blank" rel="noopener noreferrer" href="https://github.com/webpack/webpack-cli/pull/3759" class="link-_707cf  link_3b154 inline-link_3b154">https://github.com/webpack/webpack-cli/pull/3759</a> ，相信不久的将来 rspack 也会跟上。</p>
</blockquote>
<p class="my-4 leading-7">老项目之前的方案是根据环境变量，将不同的 webpack 配置使用 webpack-merge 进行合并，由此达到多环境配置的目的。
这里参考 vite 的模式 <a target="_blank" rel="noopener noreferrer" href="https://cn.vitejs.dev/guide/env-and-mode.html" class="link-_707cf  link_3b154 inline-link_3b154">https://cn.vitejs.dev/guide/env-and-mode.html</a> ，根据环境变量加载不同的 dotenv 。</p>
<div class="language-javascript"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-javascript" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">const</span><span> dotenv </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-function)">require</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&#x27;dotenv&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">const</span><span> dotenvExpand </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-function)">require</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&#x27;dotenv-expand&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">const</span><span> path </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-function)">require</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&#x27;path&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">const</span><span> fs </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-function)">require</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&#x27;fs&#x27;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)">// 处理默认环境变量</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>process</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>env</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-constant)">CI_COMMIT_SHORT_SHA</span><span> </span><span class="token operator">=</span><span> process</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>env</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-constant)">CI_COMMIT_SHORT_SHA</span><span> </span><span class="token operator">||</span><span> </span><span class="token" style="color:var(--code-token-string)">&#x27;0&#x27;</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-comment)">/**
</span></span><span style="display:block;padding:0 1.25rem;color:var(--code-token-comment)" class="token"> * 加载env文件
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-comment)" class="token"> * @param mode {string} 环境变量模式
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-comment)" class="token"> * @param envDir {string} env文件目录
</span><span style="display:block;padding:0 1.25rem;color:var(--code-token-comment)" class="token"> * @param prefixes {undefined | string[]} env变量前缀，只有该前缀的变量才会导出到客户端
</span><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-comment)"> */</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">function</span><span> </span><span class="token" style="color:var(--code-token-function)">loadEnv</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token parameter">mode</span><span class="token parameter" style="color:var(--code-token-punctuation)">,</span><span class="token parameter"> envDir</span><span class="token parameter" style="color:var(--code-token-punctuation)">,</span><span class="token parameter"> prefixes</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-keyword)">if</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token operator">!</span><span>prefixes</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    prefixes </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token" style="color:var(--code-token-string)">&quot;LB_&quot;</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-keyword)">if</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>mode </span><span class="token operator">===</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;local&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">throw</span><span> </span><span class="token" style="color:var(--code-token-keyword)">new</span><span> </span><span class="token class-name">Error</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;local mode is not supported&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-keyword)">const</span><span> env </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-keyword)">const</span><span> envFiles </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-string)">&quot;.env&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token template-string template-punctuation" style="color:var(--code-token-string)">`</span><span class="token template-string" style="color:var(--code-token-string)">.env.local</span><span class="token template-string template-punctuation" style="color:var(--code-token-string)">`</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token template-string template-punctuation" style="color:var(--code-token-string)">`</span><span class="token template-string" style="color:var(--code-token-string)">.env.</span><span class="token template-string interpolation interpolation-punctuation" style="color:var(--code-token-punctuation)">${</span><span class="token template-string interpolation">mode</span><span class="token template-string interpolation interpolation-punctuation" style="color:var(--code-token-punctuation)">}</span><span class="token template-string template-punctuation" style="color:var(--code-token-string)">`</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token template-string template-punctuation" style="color:var(--code-token-string)">`</span><span class="token template-string" style="color:var(--code-token-string)">.env.</span><span class="token template-string interpolation interpolation-punctuation" style="color:var(--code-token-punctuation)">${</span><span class="token template-string interpolation">mode</span><span class="token template-string interpolation interpolation-punctuation" style="color:var(--code-token-punctuation)">}</span><span class="token template-string" style="color:var(--code-token-string)">.local</span><span class="token template-string template-punctuation" style="color:var(--code-token-string)">`</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-keyword)">const</span><span> parsed </span><span class="token operator">=</span><span> Object</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">fromEntries</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    envFiles</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">flatMap</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token parameter">file</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span> </span><span class="token operator">=&gt;</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-keyword)">const</span><span> filePath </span><span class="token operator">=</span><span> path</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">join</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>envDir</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> file</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-keyword)">const</span><span> fileStat </span><span class="token operator">=</span><span> fs</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">statSync</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>filePath</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span> </span><span class="token literal-property" style="color:var(--code-token-parameter)">throwIfNoEntry</span><span class="token operator">:</span><span> </span><span class="token boolean">false</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-keyword)">if</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>fileStat </span><span class="token operator">&amp;&amp;</span><span> fileStat</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">isFile</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-keyword)">return</span><span> Object</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">entries</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>dotenv</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">parse</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>fs</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">readFileSync</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>filePath</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      </span><span class="token" style="color:var(--code-token-keyword)">return</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-comment)">// 该指令除了处理env中的${}引用，还会将env中的变量注入到process.env中</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  dotenvExpand</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">expand</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">{</span><span> parsed </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-comment)">// 检查变量的前缀，只有LB_开头的变量才会导出到客户端</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-keyword)">for</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-keyword)">const</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>key</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> value</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span> </span><span class="token" style="color:var(--code-token-keyword)">of</span><span> Object</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">entries</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>parsed</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">if</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>prefixes</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">some</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token parameter">prefix</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span> </span><span class="token operator">=&gt;</span><span> key</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">startsWith</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>prefix</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      env</span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>key</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span> </span><span class="token operator">=</span><span> value</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-comment)">// 检查环境变量中是否还存在LB_开头的变量，如果存在，也导出到客户端</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-keyword)">for</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-keyword)">const</span><span> key </span><span class="token" style="color:var(--code-token-keyword)">in</span><span> process</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>env</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-keyword)">if</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>prefixes</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">some</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token parameter">prefix</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span> </span><span class="token operator">=&gt;</span><span> key</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">startsWith</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>prefix</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>      env</span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>key</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span> </span><span class="token operator">=</span><span> process</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>env</span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>key</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-keyword)">return</span><span> env</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>module</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>exports </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    loadEnv</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">}</span></span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<h3 id="webpack-插件无法兼容-rspack" class="mt-10 mb-2 leading-7 text-xl title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#webpack-插件无法兼容-rspack">#</a>webpack 插件无法兼容 rspack</h3>
<p class="my-4 leading-7">项目中的 luban-cms 模块使用了 <a target="_blank" rel="noopener noreferrer" href="https://github.com/JetBrains/svg-sprite-loader" class="link-_707cf  link_3b154 inline-link_3b154">svg-sprite-loader</a> 来处理 svg 图标。
这个插件使用的 API 在 rspack 中报错。由于没有找到其它代替的插件来解决 svg 图标构建的问题，这里继续使用 webpack 构建 svg 图标库，
将构建成品引入项目。</p>
<p class="my-4 leading-7">这里贴一个 webpack 的配置，其它项目通过 luban-icons/dist/icons.js 的方式引用生成的 svg 图标库。</p>
<p class="my-4 leading-7"><img alt="luban-icons" src="/static/image/luban-icons.0f2e4939.png"/></p>
<div class="language-javascript"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-javascript" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-keyword)">const</span><span> path </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-function)">require</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;path&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">const</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span> CleanWebpackPlugin </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span> </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-function)">require</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;clean-webpack-plugin&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-keyword)">const</span><span> webpack </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-function)">require</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-string)">&quot;webpack&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">;</span><span>
</span></span><span style="display:block;padding:0 1.25rem">
</span><span style="display:block;padding:0 1.25rem"><span>module</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span>exports </span><span class="token operator">=</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token literal-property" style="color:var(--code-token-parameter)">mode</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;production&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token literal-property" style="color:var(--code-token-parameter)">entry</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;./index.js&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token literal-property" style="color:var(--code-token-parameter)">output</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token literal-property" style="color:var(--code-token-parameter)">path</span><span class="token operator">:</span><span> path</span><span class="token" style="color:var(--code-token-punctuation)">.</span><span class="token" style="color:var(--code-token-function)">resolve</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span>__dirname</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;dist&quot;</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token literal-property" style="color:var(--code-token-parameter)">filename</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;icons.js&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token literal-property" style="color:var(--code-token-parameter)">module</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token literal-property" style="color:var(--code-token-parameter)">rules</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>                </span><span class="token literal-property" style="color:var(--code-token-parameter)">test</span><span class="token operator">:</span><span> </span><span class="token regex-delimiter" style="color:var(--code-token-keyword)">/</span><span class="token regex-source language-regex" style="color:var(--code-token-keyword)">\.svg$</span><span class="token regex-delimiter" style="color:var(--code-token-keyword)">/</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>                </span><span class="token literal-property" style="color:var(--code-token-parameter)">use</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>                    </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>                        </span><span class="token literal-property" style="color:var(--code-token-parameter)">loader</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;svg-sprite-loader&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>                        </span><span class="token literal-property" style="color:var(--code-token-parameter)">options</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>                            </span><span class="token literal-property" style="color:var(--code-token-parameter)">symbolId</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;luban-icon-[name]&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>                        </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>                    </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>                </span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>            </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>        </span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token literal-property" style="color:var(--code-token-parameter)">plugins</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">[</span><span class="token" style="color:var(--code-token-keyword)">new</span><span> </span><span class="token class-name">webpack</span><span class="token class-name" style="color:var(--code-token-punctuation)">.</span><span class="token class-name">ProgressPlugin</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span> </span><span class="token" style="color:var(--code-token-keyword)">new</span><span> </span><span class="token class-name">CleanWebpackPlugin</span><span class="token" style="color:var(--code-token-punctuation)">(</span><span class="token" style="color:var(--code-token-punctuation)">)</span><span class="token" style="color:var(--code-token-punctuation)">]</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">;</span></span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<h2 id="成果" class="mt-14 mb-6 text-2xl tracking-tight title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#成果">#</a>成果</h2>
<h3 id="单模块构建" class="mt-10 mb-2 leading-7 text-xl title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#单模块构建">#</a>单模块构建</h3>
<p class="my-4 leading-7">这里选择文件依赖数量最多的 luban-cms 模块，本地执行 <code>yarn run build</code> 执行进行构建。yarn 命令统计的耗时从 21s 提升到 5s。
基于 Rspack 构建成品的速度提升了大概 4 倍。</p>
<p class="my-4 leading-7"><img alt="构建耗时对比" src="/static/image/rspack-vs-webpack.6721e2a3.png"/></p>
<p class="my-4 leading-7">为此我还专门去推上吹了一波~</p>
<p class="my-4 leading-7"><a target="_blank" rel="noopener noreferrer" href="https://twitter.com/sumygg/status/1719993104592425311" class="link-_707cf  link_3b154 inline-link_3b154">https://twitter.com/sumygg/status/1719993104592425311</a></p>
<p class="my-4 leading-7"><img alt="都给我去用" src="/static/image/aniya-with-rspack-in-twitter.379631e2.png"/></p>
<h3 id="流水线集成构建" class="mt-10 mb-2 leading-7 text-xl title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#流水线集成构建">#</a>流水线集成构建</h3>
<p class="my-4 leading-7">将整个项目构建流迁移到新版流水线上，排除首次构建缓存的影响，已第二次构建的时间作为总体的构建时间。
计算从代码拉取到推送完 docker 的总时间。由于阶段之间的环节是并行执行的，总时间计算的是各阶段的耗时总和，
而每个阶段取其中最长时间的环节作为该阶段的耗时。</p>
<p class="my-4 leading-7"><strong class="font-semibold">迁移前</strong></p>
<p class="my-4 leading-7">19+20+133+134+175=481s</p>
<p class="my-4 leading-7"><img alt="迁移前" src="/static/image/before-flow.01054f44.png"/>
<img alt="迁移前耗时" src="/static/image/before-flow-time.c5e326a8.png"/></p>
<p class="my-4 leading-7"><strong class="font-semibold">迁移后</strong></p>
<p class="my-4 leading-7">8+20+58+117=203s</p>
<p class="my-4 leading-7"><img alt="迁移后" src="/static/image/after-flow.11a6fc30.png"/>
<img alt="迁移后耗时" src="/static/image/after-flow-time.6614d0a2.png"/></p>
<p class="my-4 leading-7">可以看到除了简化了 流水线 上配置的构建步骤外（6步 缩减为 3步），构建时长也从 481s 缩减到了 203s 。构建速度大概提升了 2 倍。</p>
<p class="my-4 leading-7">不过构建 docker 镜像的耗时也是一个大头，还有 miflow 平台的资源调度也存在一定的耗时，后续考虑如何优化这一部分构建。</p>
<h2 id="其它-monorepo-场景" class="mt-14 mb-6 text-2xl tracking-tight title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#其它-monorepo-场景">#</a>其它 Monorepo 场景</h2>
<p class="my-4 leading-7">除了鲁班项目迁移遇到的一些场景，下面再介绍几个常见的 Monorepo 的使用场景。</p>
<h3 id="前端组件库" class="mt-10 mb-2 leading-7 text-xl title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#前端组件库">#</a>前端+组件库</h3>
<p class="my-4 leading-7">这可能是最初的使用方式了吧，包括一些开源的项目都是使用的这种方式。通过命令执行将构建的成品推送到 artifactory 上。</p>
<p class="my-4 leading-7">当然也需要一些工具链的配置，比如自动修改版本号、自动构建、自动publish等。</p>
<p class="my-4 leading-7">在我编写的midway-mi组件库中，就尝试了turbo+changeset的模式，感兴趣的可以尝试一下。</p>
<p class="my-4 leading-7"><a target="_blank" rel="noopener noreferrer" href="https://turbo.build/repo/docs/handbook/publishing-packages/versioning-and-publishing" class="link-_707cf  link_3b154 inline-link_3b154">https://turbo.build/repo/docs/handbook/publishing-packages/versioning-and-publishing</a></p>
<div class="language-json5"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-json5" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span>{
</span></span><span style="display:block;padding:0 1.25rem">  &quot;scripts&quot;: {
</span><span style="display:block;padding:0 1.25rem">    // Include build, lint, test - all the things you need to run
</span><span style="display:block;padding:0 1.25rem">    // before publishing
</span><span style="display:block;padding:0 1.25rem">    &quot;publish-packages&quot;: &quot;turbo run build lint test &amp;&amp; changeset version &amp;&amp; changeset publish&quot; 
</span><span style="display:block;padding:0 1.25rem">  }
</span><span style="display:block;padding:0 1.25rem">}</span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<h3 id="前端node后端共享类型" class="mt-10 mb-2 leading-7 text-xl title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#前端node后端共享类型">#</a>前端+node后端共享类型</h3>
<p class="my-4 leading-7">Node 服务提供接口，返回给前端页面展示使用。由于都是使用的 js 语言的关系，可以共享前后端的类型。</p>
<p class="my-4 leading-7">假设这个共享类型的模块叫 shared-types。</p>
<p class="my-4 leading-7">前端可以在 package.json 文件里添加该依赖，然后在代码中引入对应的类型即可。打包工具会处理公共模块内的代码并引入。</p>
<p class="my-4 leading-7">后端服务没有打包工具，只是根据依赖文件的路径解析文件，并加载执行。所以一个模块要给后端使用，需要实时进行构建。</p>
<div class="language-json"><div class="rspress-code-content rspress-scrollbar"><div><pre class="code" style="background-color:inherit"><code class="language-json" style="white-space:pre"><span style="display:block;padding:0 1.25rem"><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-parameter)">&quot;name&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;shared-types&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-parameter)">&quot;version&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;1.0.0&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-parameter)">&quot;license&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;MIT&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-parameter)">&quot;private&quot;</span><span class="token operator">:</span><span> </span><span class="token boolean">true</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-parameter)">&quot;main&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;./dist/index.js&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-parameter)">&quot;types&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;./dist/index.d.ts&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-parameter)">&quot;scripts&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-parameter)">&quot;afterinstall&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;npm run build&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-parameter)">&quot;build&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;tsup src/index.ts --format cjs --dts&quot;</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-parameter)">&quot;dev&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;npm run build -- --watch&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-parameter)">&quot;dependencies&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-parameter)">&quot;typescript&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;latest&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span class="token" style="color:var(--code-token-punctuation)">,</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-parameter)">&quot;devDependencies&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-punctuation)">{</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>    </span><span class="token" style="color:var(--code-token-parameter)">&quot;tsup&quot;</span><span class="token operator">:</span><span> </span><span class="token" style="color:var(--code-token-string)">&quot;^6.5.0&quot;</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span>  </span><span class="token" style="color:var(--code-token-punctuation)">}</span><span>
</span></span><span style="display:block;padding:0 1.25rem"><span></span><span class="token" style="color:var(--code-token-punctuation)">}</span></span></code></pre></div><div class="code-button-group_15153"><button><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrapped_15153"><path fill="#22a041" d="M21 5H3v2h18zM3 19h7v-2H3zm0-6h15c1 0 2 .43 2 2s-1 2-2 2h-2v-2l-4 3 4 3v-2h2c2.95 0 4-1.27 4-4 0-2.72-1-4-4-4H3z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="icon-wrap_15153"><path fill="currentColor" d="M16 7H3V5h13v2M3 19h13v-2H3v2m19-7-4-3v2H3v2h15v2l4-3Z"></path></svg></button><button class="code-copy-button_15153"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 30 30" class="icon-copy_15153"><path fill="currentColor" d="M28 10v18H10V10h18m0-2H10a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2Z"></path><path fill="currentColor" d="M4 18H2V4a2 2 0 0 1 2-2h14v2H4Z"></path></svg><svg width="32" height="32" viewBox="0 0 30 30" class="icon-success_15153"><path fill="#49cd37" d="m13 24-9-9 1.414-1.414L13 21.171 26.586 7.586 28 9 13 24z"></path></svg></button></div></div></div>
<p class="my-4 leading-7">与以往不同的是 dev 命令添加了 <code>--watch</code> 参数，用于监听文件变化，并在文件修改后实时将文件构建成 cjs 格式的成品文件。</p>
<h2 id="总结" class="mt-14 mb-6 text-2xl tracking-tight title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#总结">#</a>总结</h2>
<p class="my-4 leading-7">使用 Monorepo 后一方面能够很好的组织隔离各模块的依赖，另一方面也使得代码结构变得清晰。</p>
<p class="my-4 leading-7">而 Rspack 对编译速度的提升非常明显。由于 Rspack 对 webpack API 兼容支持比较高，迁移 Rspack 没有遇到大的兼容性问题。
当然一些与 Rspack 不兼容的 webpack 插件，在迁移的过程中没有将中心放在改造插件上，采用了继续使用 webpack 构建成 js 成品再引入项目的方式来解决。
另外一些特性比如加载 dotenv 后续也期望 Rspack 能够尽快支持。</p>
<p class="my-4 leading-7">再后续也会考虑将 Rspack 应用到其它业务中，例如作为 taro 或 umijs 的底层。不过 Rspack 不支持 Module Federation 的特性的问题还是需要权衡一下的。</p>
<p class="my-4 leading-7">以上只是对项目迁移的一个粗略的介绍，很多细节没有详细进行说明。如果你有好的想法或其它想详细了解的内容，欢迎与我探讨。</p>
<h2 id="参考内容" class="mt-14 mb-6 text-2xl tracking-tight title_3b154"><a class="link_3b154 header-anchor" aria-hidden="true" href="#参考内容">#</a>参考内容</h2>
<ul class="list-disc pl-5 my-4 leading-7">
<li class="[&amp;:not(:first-child)]:mt-2"><a target="_blank" rel="noopener noreferrer" href="https://juejin.cn/post/7202441529150767162" class="link-_707cf  link_3b154 inline-link_3b154">monorepo介绍与实践🥂 - 掘金</a></li>
<li class="[&amp;:not(:first-child)]:mt-2"><a target="_blank" rel="noopener noreferrer" href="https://www.rspack.dev/" class="link-_707cf  link_3b154 inline-link_3b154">rspack</a></li>
</ul><!--/$--></div><div class="rspress-doc-footer"><div class="postFooter_2e2af flex flex-col"><div class="flex flex-col sm:flex-row sm:justify-around gap-4 pt-6"><div class="prev_edac1 flex flex-col"><a class="link_03735 pagerLink_edac1 cursor-pointer" target="" href="/2023/06/02/ctf-mobile-startup/index.html"><span class="desc_edac1">上一篇</span><span class="title_edac1">CTF Mobile 基础入门</span></a></div><div class="next_edac1 flex flex-col"><a class="link_03735 pagerLink_edac1 next_edac1 cursor-pointer" target="" href="/2023/10/31/solutions-to-xiaomi-programming-competition-2023/index.html"><span class="desc_edac1">下一篇</span><span class="title_edac1">小米2023年度编程挑战赛分享</span></a></div></div></div><footer class="mt-8"><div class="xs:flex pb-5 px-2 justify-end items-center"><div class="flex text-sm text-text-2 leading-6 sm:leading-8 font-medium"><p>最后编辑时间<!-- -->: <span>2024/2/12 18:55:54</span></p></div></div><div class="flex flex-col"><a href="https://github.com/sumy7/SumyBlog-rspress/blob/main/source/../source/_posts/2023-09-07-luban-platform-in-actions-monorepo-and-rspack/2023-09-07-luban-platform-in-actions-monorepo-and-rspack.md" target="_blank" class="editLink_2a169">📝 在 GitHub 上编辑此页</a></div><div class="flex flex-col sm:flex-row sm:justify-around gap-4 pt-6"><div class="prev_e7091 flex flex-col"></div><div class="next_e7091 flex flex-col"></div></div></footer></div></div></div><div class="aside-container_edeb4"><div><div></div><div class="flex flex-col"><div class="&lt;lg:hidden"><div id="aside-container" class="relative text-sm font-medium"><div class="leading-7 block text-sm font-semibold pl-3">目录</div><nav class="mt-1"><ul class="relative"><li><a href="#什么是monorepo" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:0;font-weight:semibold"><span class="aside-link-text block">什么是Monorepo？</span></a></li><li><a href="#rspack" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:0;font-weight:semibold"><span class="aside-link-text block">Rspack</span></a></li><li><a href="#项目结构优化" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:0;font-weight:semibold"><span class="aside-link-text block">项目结构优化</span></a></li><li><a href="#创建-monorepo-工程" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:12px;font-weight:semibold"><span class="aside-link-text block">创建 Monorepo 工程</span></a></li><li><a href="#项目内的模块依赖" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:12px;font-weight:semibold"><span class="aside-link-text block">项目内的模块依赖</span></a></li><li><a href="#postcssconfigjs" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:12px;font-weight:semibold"><span class="aside-link-text block">postcss.config.js</span></a></li><li><a href="#构建-docker-镜像" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:12px;font-weight:semibold"><span class="aside-link-text block">构建 docker 镜像</span></a></li><li><a href="#构建前端页面" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:24px;font-weight:semibold"><span class="aside-link-text block">构建前端页面</span></a></li><li><a href="#构建-node-服务" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:24px;font-weight:semibold"><span class="aside-link-text block">构建 node 服务</span></a></li><li><a href="#迁移rspack" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:0;font-weight:semibold"><span class="aside-link-text block">迁移rspack</span></a></li><li><a href="#迁移配置文件" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:12px;font-weight:semibold"><span class="aside-link-text block">迁移配置文件</span></a></li><li><a href="#多环境配置文件" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:12px;font-weight:semibold"><span class="aside-link-text block">多环境配置文件</span></a></li><li><a href="#webpack-插件无法兼容-rspack" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:12px;font-weight:semibold"><span class="aside-link-text block">webpack 插件无法兼容 rspack</span></a></li><li><a href="#成果" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:0;font-weight:semibold"><span class="aside-link-text block">成果</span></a></li><li><a href="#单模块构建" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:12px;font-weight:semibold"><span class="aside-link-text block">单模块构建</span></a></li><li><a href="#流水线集成构建" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:12px;font-weight:semibold"><span class="aside-link-text block">流水线集成构建</span></a></li><li><a href="#其它-monorepo-场景" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:0;font-weight:semibold"><span class="aside-link-text block">其它 Monorepo 场景</span></a></li><li><a href="#前端组件库" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:12px;font-weight:semibold"><span class="aside-link-text block">前端+组件库</span></a></li><li><a href="#前端node后端共享类型" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:12px;font-weight:semibold"><span class="aside-link-text block">前端+node后端共享类型</span></a></li><li><a href="#总结" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:0;font-weight:semibold"><span class="aside-link-text block">总结</span></a></li><li><a href="#参考内容" class="aside-link transition-all duration-300 hover:text-text-1 text-text-2 block" style="padding-left:0;font-weight:semibold"><span class="aside-link-text block">参考内容</span></a></li></ul></nav></div></div></div></div></div></div></div></section><footer class="mt-6 py-8 px-6 sm:p-8 w-full border-t border-solid border-divider-light"><div class="m-auto w-full text-center"><div class="font-meduim text-sm text-text-2">© 2015-<!-- -->2024<!-- --> SumyBlog. Powered by<!-- --> <a href="https://rspress.dev/" target="_blank" rel="noreferrer">Rspress</a>.</div></div></footer></div></div></div><div id="search-container"></div></body></html>