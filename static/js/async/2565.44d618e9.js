/*! For license information please see 2565.44d618e9.js.LICENSE.txt */
(self.webpackChunk_sumyblog_rspress_blog=self.webpackChunk_sumyblog_rspress_blog||[]).push([["2565"],{21397:function(n,e,s){"use strict";s.r(e);var r=s("35250"),o=s("51325");function l(n){let e=Object.assign({h1:"h1",a:"a",p:"p",ol:"ol",li:"li",pre:"pre",code:"code",ul:"ul",strong:"strong",h2:"h2"},(0,o.useMDXComponents)(),n.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(e.h1,{id:"\u89E3\u6790\u7528\u6237\u8F93\u5165\u8868\u8FBE\u5F0F\u7684\u503C\u7B80\u6613\u7684js\u6C99\u7BB1",children:[(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#\u89E3\u6790\u7528\u6237\u8F93\u5165\u8868\u8FBE\u5F0F\u7684\u503C\u7B80\u6613\u7684js\u6C99\u7BB1",children:"#"}),"\u89E3\u6790\u7528\u6237\u8F93\u5165\u8868\u8FBE\u5F0F\u7684\u503C\uFF0C\u7B80\u6613\u7684JS\u6C99\u7BB1"]}),"\n",(0,r.jsx)(e.p,{children:"\u6709\u65F6\u5019\u6211\u4EEC\u9700\u8981\u89E3\u6790\u7528\u6237\u8F93\u5165\u7684\u8868\u8FBE\u5F0F\uFF0C\u7528\u6237\u8F93\u5165\u7684\u8868\u8FBE\u5F0F\u5343\u5947\u767E\u602A\uFF0C\u5982\u4F55\u63A7\u5236\u53EA\u80FD\u4F7F\u7528\u6307\u5B9A\u7684\u51FD\u6570\uFF0C\u5236\u4F5C\u4E00\u4E2A\u7B80\u6613\u7684\u6C99\u7BB1\u73AF\u5883\uFF1F"}),"\n",(0,r.jsx)(e.p,{children:"\u53C2\u8003Vue\u7684\u4EE3\u7801\uFF0C\u5B9E\u73B0\u4EE5\u4E0B\u6548\u679C\uFF1A"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u83B7\u53D6\u7528\u6237\u8F93\u5165\u8868\u8FBE\u5F0F\u5B57\u7B26\u4E32\u7684\u503C"}),"\n",(0,r.jsx)(e.li,{children:"\u53EA\u80FD\u8BBF\u95EE\u6307\u5B9A\u5BF9\u8C61\u4E0A\u7684\u503C"}),"\n",(0,r.jsx)(e.li,{children:"\u4E0D\u80FD\u8BBF\u95EEglobal/window\u4E0A\u5B9A\u4E49\u7684\u53D8\u91CF\u5C5E\u6027"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u4EE3\u7801\u53CA\u6D4B\u8BD5\u4EE3\u7801\u5982\u4E0B\uFF1A"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-javascript",meta:"",children:"function makeMap(str, expectsLowerCase) {\n    var map = Object.create(null);\n    var list = str.split(',');\n    for (var i = 0; i < list.length; i++) {\n        map[list[i]] = true;\n    }\n\n    return expectsLowerCase ?\n        function (val) {\n            return map[val.toLowerCase()];\n        } :\n        function (val) {\n            return map[val];\n        }\n}\n\nvar allowedGlobal = makeMap('Infinity,undefined,NaN,isFinite,isNaN,' +\n    'parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,' +\n    'Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,' +\n    'require');\n\nvar hasHandler = {\n    has: function has(target, key) {\n        const hasKey = key in target;\n        const isAllowed = allowedGlobal(key);\n        return hasKey || !isAllowed;\n    }\n};\n\nvar vm = {\n    foo: -1\n};\n\nvar vm = new Proxy(vm, hasHandler);\n\nvar buildFunction = function (vm, expression) {\n    var fun = new Function(\"vm\", `\n        with(vm) {\n            return ${expression};\n        }\n    `);\n    return function () {\n        return fun(vm);\n    };\n}\n\n// \u5C1D\u8BD5\u8BBF\u95EEvm\u4E0A\u7684foo\u5BF9\u8C61\uFF0C\u548C\u5168\u5C40\u5B9A\u4E49\u7684Math\u5BF9\u8C61\nvar okExpression = 'Math.abs(foo)';\nvar okEval = buildFunction(vm, okExpression);\nokEval();\n\n// \u5C1D\u8BD5\u8BBF\u95EE\u5168\u5C40\u7684test_foo\nwindow.test_foo = \"Hello there\";\nvar errExpression = 'test_foo || window.test_foo';\nvar errEval = buildFunction(vm, errExpression);\nerrEval();\n"})}),"\n",(0,r.jsxs)(e.p,{children:["\u7A0D\u5FAE\u89E3\u91CA\u4E00\u4E0B\u539F\u7406\uFF1A\u4F7F\u7528JS\u7684Proxy\u4EE3\u7406\uFF0ChasHandler\u7528\u4E8E\u62E6\u622A\u5224\u65AD\u67D0\u4E2A\u5C5E\u6027\u662F\u5426\u5B58\u5728\u5BF9\u8C61\u4E0A\u7684\u64CD\u4F5C\u3002\u8FD9\u91CC\u7528\u5230\u4E86Proxy\u7684\u4E24\u4E2A\u62E6\u622A\u5668\u2014\u2014",(0,r.jsx)(e.code,{children:"has"})," \u548C ",(0,r.jsx)(e.code,{children:"get"}),"\u3002",(0,r.jsx)(e.code,{children:"has"})," \u7528\u4E8E\u8868\u660E\u7ED9\u5B9A\u7684\u5C5E\u6027\u662F\u5426\u5728\u8BE5\u5BF9\u8C61\u5185\uFF0C\u5982\u679C\u4E0D\u5728\u5F15\u64CE\u4F1A\u5C1D\u8BD5\u5411\u5916\u5C42\u4F5C\u7528\u4E8E\u67E5\u627E\u3002",(0,r.jsx)(e.code,{children:"get"})," \u7528\u4E8E\u4ECE\u67E5\u627E\u5230\u7684\u4F5C\u7528\u4E8E\u91CC\u83B7\u53D6\u5BF9\u5E94\u5C5E\u6027\u7684\u503C\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:["\u8FD9\u91CC\u4F7F\u7528\u4E86 ",(0,r.jsx)(e.code,{children:"has"})," \u8FDB\u884C\u62E6\u622A\u64CD\u4F5C\uFF1A"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u5982\u679C\u8BBF\u95EE\u7684\u5C5E\u6027\u5DF2\u7ECF\u5B58\u5728vm\u5BF9\u8C61\u4E0A\uFF0C\u5219 ",(0,r.jsx)(e.code,{children:"has"})," \u76F4\u63A5\u58F0\u660E\u5B58\u5728\u5F53\u524D\u5BF9\u8C61\u4E0A"]}),"\n",(0,r.jsxs)(e.li,{children:["\u5982\u679C\u5C5E\u6027\u4E0D\u5728vm\u5BF9\u8C61\u4E0A\uFF0C\u4F46\u662F\u5728allowedGlobal\u4E2D\uFF0C\u5219 ",(0,r.jsx)(e.code,{children:"has"})," \u58F0\u660E\u53D8\u91CF\u4E0D\u5728\u8BE5\u5BF9\u8C61\u4E0A\uFF0C\u5F15\u64CE\u4F1A\u5F80\u5916\u5C42\u4F5C\u7528\u57DF\u67E5\u627E\uFF0C\u6700\u7EC8\u627E\u5230window/global\u5BF9\u8C61\u4E0A\u7684\u5C5E\u6027"]}),"\n",(0,r.jsxs)(e.li,{children:["\u5982\u679C\u5C5E\u6027\u4E0D\u5728vm\u5BF9\u8C61\u4E0A\uFF0C\u4E5F\u4E0D\u5728allowedGlobal\u4E2D\uFF0C\u5219 ",(0,r.jsx)(e.code,{children:"has"})," \u58F0\u660E\u53D8\u91CF\u5728\u8BE5\u5BF9\u8C61\u4E0A\uFF0C\u62E6\u622A\u5F15\u64CE\u7684\u5916\u5C42\u4F5C\u7528\u57DF\u67E5\u627E\u64CD\u4F5C\u3002\u540E\u7EED\u901A\u8FC7 ",(0,r.jsx)(e.code,{children:"get"})," \u5728\u5F53\u524D\u5BF9\u8C61\u8FD4\u56DE\u5C5E\u6027\u503C\u65F6\u53EA\u80FD\u83B7\u53D6\u5230 ",(0,r.jsx)(e.strong,{children:"undefined"}),"\uFF0C\u8FBE\u5230\u62E6\u622A\u5BF9window/global\u5C5E\u6027\u8BBF\u95EE\u7684\u76EE\u7684"]}),"\n"]}),"\n",(0,r.jsxs)(e.h2,{id:"\u53C2\u8003\u5185\u5BB9",children:[(0,r.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#\u53C2\u8003\u5185\u5BB9",children:"#"}),"\u53C2\u8003\u5185\u5BB9"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://github.com/vuejs/vue/blob/78c3ce0ce0c2230f657cb7772a84fc7aa7ce0825/src/core/instance/proxy.js#L9",target:"_blank",rel:"noopener noreferrer",children:"proxy.js-vuejs-Github"})}),"\n"]})]})}function a(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,o.useMDXComponents)(),n.components);return e?(0,r.jsx)(e,Object.assign({},n,{children:(0,r.jsx)(l,n)})):l(n)}e.default=a,a.__RSPRESS_PAGE_META={},a.__RSPRESS_PAGE_META["..%2Fsource%2F_posts%2F2021-03-22-eval-js-expression-that-can-only-use-allowed-functions%2F2021-03-22-eval-js-expression-that-can-only-use-allowed-functions.md"]={toc:[{id:"\u53C2\u8003\u5185\u5BB9",text:"\u53C2\u8003\u5185\u5BB9",depth:2}],title:"\u89E3\u6790\u7528\u6237\u8F93\u5165\u8868\u8FBE\u5F0F\u7684\u503C\uFF0C\u7B80\u6613\u7684JS\u6C99\u7BB1",frontmatter:{layout:"post",title:"\u89E3\u6790\u7528\u6237\u8F93\u5165\u8868\u8FBE\u5F0F\u7684\u503C\uFF0C\u7B80\u6613\u7684JS\u6C99\u7BB1",date:"2021-03-22 23:42:01",categories:["\u679C\u7136\u8FD8\u662F\u524D\u7AEF"],tags:["javascript","expression","\u8868\u8FBE\u5F0F","\u6C99\u7BB1"]}}}}]);